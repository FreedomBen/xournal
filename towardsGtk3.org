* Moving Xournal to gtk3

** Currently working <2013-09-22 Sun>

- DO NOT USE YET. This branch is still broken
- There are lots of features that work, but a lot that does not work
- Below I have listed the features that have been ported, but are broken

** What is broken seriously (and would impede using it)

*** [TODO] Loading pdf backgrounds does not  properly display if continous and multipage.
  
- Interestingly it works if the file is loaded one page, then switched to continuous 
  This seems to imply to execution paths for the same code.
- Canvas items are properly displayed where they belong

*** [TODO] strokes with variable width

- They need to inherit the color from its parent, that way it is easy to change it
- They cannot be selected!

*** [TODO] Drawing of items needs to add the color
    
- which I removed by .... stupidity? Makes the code more complicated... 

*** [TODO] Selection

- It does not work for strokes of variable length
- It assert faults under some situations (I think i fixed it). The
  main problem is that rectangles are no longer drawn with four
  points, but with x,y width and height and they do not allow negative
  withds/heights. This means we always have to draw from left/top
  point.  One alternative is to use a path.

*** [TODO] Undo-Redo

- I think there are issues that need to be implemented. At the very
  least, it needs testing

*** [TODO] lots of things
Search for WARN or assert(0):

- implement Dialog windows (there is a deprecation in gtk3 that I need
  to fix). This affects everything that creates a dialog window.
- selection of colors
- inserting images
- inserting text
- undo/redo of some items 
- cut and paste 
- print (I think)

** Minor issues that need to be looked at

*** [TODO] Mouse shapes

- I have observed some cases in which the shape of the mouse during
  resizing of a region stays even after the resizing. Needs investigation


*** [TODO] it does not center the screen in the canvas when it is rezized




*** [TODO] the screen needs to be redrawn after each line, because there are aliasing artifacts :minor:

*** [TODO] selection rectangle is not dashed, but red :minor:


*** [TODO] the bounding box of the selection needs to be dashed instead of painted red
    
- but this is something that goo-canvas people are implementing, which
  is nice ;) it means we are supported

* Other notes

ignore from here on. This are my notes...

** Example of a port

http://www.gtkforums.com/viewtopic.php?p=9858



** Strategy

- The API is going to be different
- First get the canvas drawn with the background
- ifdef everything else

** to be done

https://developer.gnome.org/libgnomecanvas/stable/GnomeCanvas.htm
http://www.gnu.org/software/guile-gnome/docs/libgnomecanvas/html/Function-Index.html#Function-Index

These are all the instances of functions used by gnomecanvas that must be replaced


gnome_canvas_get_scroll_offsets
gnome_canvas_group_get_type

https://developer.gnome.org/goocanvas/unstable/GooCanvasItem.html

http://www.gnu.org/software/guile-gnome/docs/libgnomecanvas/html/GnomeCanvasItem.html#GnomeCanvasItem


  To convert between world and item coordinate systems call
  gnome-canvas-item-w2i, and to convert in the other direction call
  gnome-canvas-item-i2w. To get the transform for converting from item
  to world coordinates use gnome-canvas-item-i2w-affine or for
  converting item to canvas coordinates, gnome-canvas-item-i2c-affine.


| old       | new                       |
| w->window | gtk_widget_get_window(w); |


| gnomecanvas                       | goo                  |                                                                                    |
|-----------------------------------+----------------------+------------------------------------------------------------------------------------|
| gnome_canvas_item_affine_absolute | goo_canvas_get_scale | https://developer.gnome.org/goocanvas/unstable/GooCanvas.html#goo-canvas-get-scale |
| gnome_canvas_item_hide            |                      |                                                                                    |
| gnome_canvas_item_lower           |                      |                                                                                    |
| gnome_canvas_item_move            |                      |                                                                                    |
| gnome_canvas_item_new             |                      |                                                                                    |
| gnome_canvas_item_raise           |                      |                                                                                    |
| gnome_canvas_item_reparent        |                      |                                                                                    |
| gnome_canvas_item_set             |                      |                                                                                    |
| gnome_canvas_item_show            |                      |                                                                                    |


|                            |   |                               |
| gnome_canvas_line_get_type |   |                               |
| gnome_canvas_new_aa        |   | creates new antialized canvas |
|                            |   |                               |

https://developer.gnome.org/goocanvas/unstable/GooCanvasPath.html
g
nome_canvas_path_def_closepath
gnome_canvas_path_def_lineto
gnome_canvas_path_def_moveto
gnome_canvas_path_def_new_sized
gnome_canvas_path_def_unref



gnome_canvas_pixbuf_get_type
gnome_canvas_points_free
gnome_canvas_points_new
gnome_canvas_polygon_get_type
gnome_canvas_rect_get_type
gnome_canvas_root
gnome_canvas_scroll_to

gnome_canvas_set_center_scroll_region 



| gnome_canvas_set_pixels_per_unit |                       |      |
| gnome_canvas_set_pixels_per_unit |                       |      |
| gnome_canvas_set_scroll_region   | goo_canvas_set_bounds | Done |

gnome_canvas_text_get_type


gnome_canvas_widget_get_type
gnome_canvas_window_to_world

** On units

Apparently the units are handled by just setting the type of unit. No conversion is needed.

https://developer.gnome.org/goocanvas/unstable/GooCanvas.html#GooCanvas--units
